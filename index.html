<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meal Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea, input { width: 100%; padding: 8px; margin: 5px 0; }
    button { padding: 10px 15px; margin-top: 10px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: left; }
    .modal {
      display: none; position: fixed; top: 0; left: 0;
      width: 100%; height: 100%; background: rgba(0,0,0,0.6);
      justify-content: center; align-items: center;
    }
    .modal-content {
      background: #fff; padding: 20px; border-radius: 5px;
      width: 300px;
    }
  </style>
</head>
<body>
  <h2>üçΩÔ∏è Simple Meal Tracker</h2>

  <textarea id="mealInput" rows="4" placeholder="e.g. 2 roti + 1 boiled egg + 1 banana"></textarea>
  <button onclick="calculateNutrition()">Calculate Nutrition</button>
  <button onclick="openAddModal()">‚ûï Add New Food Item</button>

  <div id="results"></div>

  <!-- Add Food Modal -->
  <div id="addModal" class="modal">
    <div class="modal-content">
      <h3>Add Custom Food</h3>
      <input id="foodName" placeholder="e.g. Paneer bhurji" />
      <button onclick="fetchFromAPI()">üîç Fetch from API</button>
      <input type="number" id="caloriesVal" placeholder="Calories (kcal)" />
      <input type="number" id="proteinVal" placeholder="Protein (g)" />
      <input type="number" id="carbsVal" placeholder="Carbs (g)" />
      <input type="number" id="fatVal" placeholder="Fat (g)" />
      <button onclick="saveCustomFood()">Save</button>
      <button onclick="closeAddModal()">Cancel</button>
    </div>
  </div>

<script>
  let foodDB = {
    // Preworkout
    banana: { calories: 90, protein: 1.1, carbs: 23, fat: 0.3 },
    "5 almonds": { calories: 35, protein: 1.2, carbs: 1.2, fat: 3 },
    "3-4 raisins": { calories: 12, protein: 0.1, carbs: 3, fat: 0 },
    "dry date": { calories: 23, protein: 0.2, carbs: 6, fat: 0 },
    "2 walnuts": { calories: 52, protein: 1.2, carbs: 1.1, fat: 5 },
    "1 scoop protein + 200ml milk": { calories: 200, protein: 25, carbs: 8, fat: 5 },

    // Breakfast
    apple: { calories: 95, protein: 0.5, carbs: 25, fat: 0.3 },
    chikoo: { calories: 86, protein: 0.4, carbs: 22, fat: 1.1 },
    poha: { calories: 180, protein: 3, carbs: 30, fat: 5 },
    upma: { calories: 200, protein: 4, carbs: 30, fat: 7 },
    "shevaya upma": { calories: 190, protein: 4, carbs: 32, fat: 6 },
    "sabudana khichadi": { calories: 300, protein: 3, carbs: 45, fat: 10 },
    idli: { calories: 60, protein: 2, carbs: 12, fat: 0.5 },
    dosa: { calories: 125, protein: 2.5, carbs: 20, fat: 4 },
    sambar: { calories: 100, protein: 5, carbs: 15, fat: 3 },
    "coconut chutney": { calories: 90, protein: 1, carbs: 4, fat: 8 },
    sheera: { calories: 350, protein: 4, carbs: 50, fat: 15 },
    "protein powder with milk": { calories: 200, protein: 25, carbs: 8, fat: 5 },
    milk: { calories: 130, protein: 6.4, carbs: 10, fat: 7.6 },

    // Mid-morning
    mango: { calories: 100, protein: 1, carbs: 25, fat: 0.5 },
    orange: { calories: 60, protein: 1.2, carbs: 15, fat: 0.2 },
    watermelon: { calories: 45, protein: 0.9, carbs: 11, fat: 0.2 },
    muskmelon: { calories: 60, protein: 1, carbs: 14, fat: 0.3 },
    guava: { calories: 68, protein: 2.6, carbs: 14, fat: 1 },
    "custard apple": { calories: 94, protein: 2.1, carbs: 24, fat: 0.4 },
    papaya: { calories: 60, protein: 0.6, carbs: 15, fat: 0.1 },

    // Lunch
    roti: { calories: 80, protein: 3, carbs: 15, fat: 1 },
    "2 roti": { calories: 160, protein: 6, carbs: 30, fat: 2 },
    "3 roti": { calories: 240, protein: 9, carbs: 45, fat: 3 },
    "100g paneer": { calories: 260, protein: 18, carbs: 6, fat: 20 },
    "paneer curry": { calories: 300, protein: 16, carbs: 10, fat: 22 },
    rice: { calories: 130, protein: 2.5, carbs: 28, fat: 0.3 },
    "1 bowl rice": { calories: 200, protein: 4, carbs: 45, fat: 1 },
    dal: { calories: 140, protein: 7, carbs: 20, fat: 4 },
    "1 bowl dal": { calories: 140, protein: 7, carbs: 20, fat: 4 },
    curd: { calories: 60, protein: 3.5, carbs: 5, fat: 3 },
    "vegetable gawar": { calories: 80, protein: 2.5, carbs: 10, fat: 3 },
    "potato sabji": { calories: 150, protein: 2, carbs: 25, fat: 6 },
    "methi sabji": { calories: 120, protein: 3, carbs: 10, fat: 5 },
    palak: { calories: 70, protein: 3, carbs: 8, fat: 2 },
    bhindi: { calories: 90, protein: 2.5, carbs: 11, fat: 4 },
    dudhi: { calories: 45, protein: 1.2, carbs: 9, fat: 1 },
    pumpkin: { calories: 50, protein: 1, carbs: 12, fat: 0.2 },
    karela: { calories: 60, protein: 1.5, carbs: 13, fat: 0.5 },
    cabbage: { calories: 25, protein: 1.3, carbs: 5, fat: 0.1 },
    cauliflower: { calories: 30, protein: 2, carbs: 5, fat: 0.3 },
    capsicum: { calories: 40, protein: 1, carbs: 9, fat: 0.2 },
    beans: { calories: 50, protein: 2.4, carbs: 10, fat: 0.4 },
    cucumber: { calories: 15, protein: 0.7, carbs: 4, fat: 0.1 },
    beetroot: { calories: 40, protein: 1.6, carbs: 10, fat: 0.1 },
    carrot: { calories: 45, protein: 1, carbs: 10, fat: 0.2 },

    // Snacks & Dinner
    jaggery: { calories: 15, protein: 0, carbs: 4, fat: 0 },
    makhana: { calories: 70, protein: 3, carbs: 10, fat: 2 },
    chana: { calories: 170, protein: 9, carbs: 30, fat: 2 },
    cashews: { calories: 150, protein: 5, carbs: 9, fat: 12 },
    kadhi: { calories: 150, protein: 5, carbs: 20, fat: 6 },
    pulav: { calories: 300, protein: 6, carbs: 45, fat: 10 },
    "jowar roti": { calories: 100, protein: 2.5, carbs: 22, fat: 1.5 },
    pithla: { calories: 120, protein: 5, carbs: 10, fat: 6 },
    "pav bhaji": { calories: 400, protein: 8, carbs: 50, fat: 20 },
    daliya: { calories: 150, protein: 5, carbs: 30, fat: 1 },
    thalipeeth: { calories: 120, protein: 3, carbs: 20, fat: 4 },
    dhapate: { calories: 140, protein: 3.5, carbs: 22, fat: 5 }
  };

  const savedFoods = JSON.parse(localStorage.getItem("customFoods"));
  if (savedFoods) {
    foodDB = { ...foodDB, ...savedFoods };
  }

  function calculateNutrition() {
    const input = document.getElementById("mealInput").value.toLowerCase();
    let total = { calories: 0, protein: 0, carbs: 0, fat: 0 };
    let rows = "";

    for (let item in foodDB) {
      const regex = new RegExp(`(\\d+)?\\s*${item}`, "gi");
      let match;
      while ((match = regex.exec(input)) !== null) {
        const qty = parseFloat(match[1]) || 1;
        const data = foodDB[item];
        const itemCalories = data.calories * qty;
        const itemProtein = data.protein * qty;
        const itemCarbs = data.carbs * qty;
        const itemFat = data.fat * qty;

        total.calories += itemCalories;
        total.protein += itemProtein;
        total.carbs += itemCarbs;
        total.fat += itemFat;

        rows += `
          <tr>
            <td>${qty} ${item}</td>
            <td>${itemCalories.toFixed(1)} kcal</td>
            <td>${itemProtein.toFixed(1)} g</td>
            <td>${itemCarbs.toFixed(1)} g</td>
            <td>${itemFat.toFixed(1)} g</td>
          </tr>
        `;
      }
    }

    const resultTable = `
      <h3>Nutrition Breakdown</h3>
      <table>
        <tr><th>Item</th><th>Calories</th><th>Protein</th><th>Carbs</th><th>Fat</th></tr>
        ${rows}
        <tr style="font-weight:bold; background:#f4f4f4">
          <td>Total</td>
          <td>${total.calories.toFixed(1)} kcal</td>
          <td>${total.protein.toFixed(1)} g</td>
          <td>${total.carbs.toFixed(1)} g</td>
          <td>${total.fat.toFixed(1)} g</td>
        </tr>
      </table>
    `;

    document.getElementById("results").innerHTML = rows ? resultTable : "<p>No matches found. Try adding items or checking spelling.</p>";
  }

  function openAddModal() {
    document.getElementById("addModal").style.display = "flex";
  }

  function closeAddModal() {
    document.getElementById("addModal").style.display = "none";
    document.getElementById("foodName").value = "";
    document.getElementById("caloriesVal").value = "";
    document.getElementById("proteinVal").value = "";
    document.getElementById("carbsVal").value = "";
    document.getElementById("fatVal").value = "";
  }

  function saveCustomFood() {
    const name = document.getElementById("foodName").value.toLowerCase().trim();
    const calories = parseFloat(document.getElementById("caloriesVal").value);
    const protein = parseFloat(document.getElementById("proteinVal").value);
    const carbs = parseFloat(document.getElementById("carbsVal").value);
    const fat = parseFloat(document.getElementById("fatVal").value);

    if (!name || isNaN(calories) || isNaN(protein) || isNaN(carbs) || isNaN(fat)) {
      alert("Please fill in all fields correctly.");
      return;
    }

    foodDB[name] = { calories, protein, carbs, fat };
    localStorage.setItem("customFoods", JSON.stringify(getCustomFoods()));
    closeAddModal();
    alert(`Saved "${name}" successfully!`);
  }

  function getCustomFoods() {
    const original = ["banana", "boiled egg", "roti", "rice", "100g paneer"];
    const custom = {};
    for (let key in foodDB) {
      if (!original.includes(key)) {
        custom[key] = foodDB[key];
      }
    }
    return custom;
  }

  async function fetchFromAPI() {
    const name = document.getElementById("foodName").value.trim();
    if (!name) {
      alert("Enter a food item name first.");
      return;
    }

    const app_id = "55a75700";  // Replace with your actual Edamam App ID
    const app_key = "023ce47929a7cf45c4f6143e5591ed5a";  // Replace with your actual App Key

    const url = `https://api.edamam.com/api/nutrition-data?app_id=${app_id}&app_key=${app_key}&ingr=${encodeURIComponent(name)}`;

    try {
      const response = await fetch(url);
      const data = await response.json();

      if (!data.totalNutrients || !data.calories) {
        alert("‚ùå No nutrition data found for this item. Try refining your input or check online.");
        return;
      }

      document.getElementById("caloriesVal").value = data.calories.toFixed(1);
      document.getElementById("proteinVal").value = (data.totalNutrients.PROCNT?.quantity || 0).toFixed(1);
      document.getElementById("carbsVal").value = (data.totalNutrients.CHOCDF?.quantity || 0).toFixed(1);
      document.getElementById("fatVal").value = (data.totalNutrients.FAT?.quantity || 0).toFixed(1);

    } catch (error) {
      console.error(error);
      alert("‚ö†Ô∏è Failed to fetch from API. Check your internet or try again later.");
    }
  }
</script>

</body>
</html>
