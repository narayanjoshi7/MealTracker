<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meal Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea, input { width: 100%; padding: 8px; margin: 5px 0; }
    button { padding: 10px 15px; margin-top: 10px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: left; }
    .modal {
      display: none; position: fixed; top: 0; left: 0;
      width: 100%; height: 100%; background: rgba(0,0,0,0.6);
      justify-content: center; align-items: center;
    }
    .modal-content {
      background: #fff; padding: 20px; border-radius: 5px;
      width: 300px;
    }
  </style>
</head>
<body>
  <h2>üçΩÔ∏è Simple Meal Tracker</h2>

  <textarea id="mealInput" rows="4" placeholder="e.g. 2 roti + 1 boiled egg + 1 banana"></textarea>
  <button onclick="calculateNutrition()">Calculate Nutrition</button>
  <button onclick="openAddModal()">‚ûï Add New Food Item</button>

  <div id="results"></div>

  <!-- Add Food Modal -->
  <div id="addModal" class="modal">
    <div class="modal-content">
      <h3>Add Custom Food</h3>
      <input id="foodName" placeholder="e.g. Paneer bhurji" />
      <input type="number" id="caloriesVal" placeholder="Calories (kcal)" />
      <input type="number" id="proteinVal" placeholder="Protein (g)" />
      <input type="number" id="carbsVal" placeholder="Carbs (g)" />
      <input type="number" id="fatVal" placeholder="Fat (g)" />
      <button onclick="saveCustomFood()">Save</button>
      <button onclick="closeAddModal()">Cancel</button>
    </div>
  </div>

  <script>
    let foodDB = {
      banana: { calories: 105, protein: 1.3, carbs: 27, fat: 0.3 },
      "boiled egg": { calories: 70, protein: 6.5, carbs: 0, fat: 5 },
      roti: { calories: 80, protein: 3, carbs: 15, fat: 1 },
      rice: { calories: 130, protein: 2.5, carbs: 28, fat: 0.3 },
      "100g paneer": { calories: 260, protein: 18, carbs: 6, fat: 20 }
    };

    const savedFoods = JSON.parse(localStorage.getItem("customFoods"));
    if (savedFoods) {
      foodDB = { ...foodDB, ...savedFoods };
    }

    function calculateNutrition() {
      const input = document.getElementById("mealInput").value.toLowerCase();
      let total = { calories: 0, protein: 0, carbs: 0, fat: 0 };
      let rows = "";

      for (let item in foodDB) {
        const regex = new RegExp(`(\\d+)?\\s*${item}`, "gi");
        let match;
        while ((match = regex.exec(input)) !== null) {
          const qty = parseFloat(match[1]) || 1;
          const data = foodDB[item];
          const itemCalories = data.calories * qty;
          const itemProtein = data.protein * qty;
          const itemCarbs = data.carbs * qty;
          const itemFat = data.fat * qty;

          total.calories += itemCalories;
          total.protein += itemProtein;
          total.carbs += itemCarbs;
          total.fat += itemFat;

          rows += `
            <tr>
              <td>${qty} ${item}</td>
              <td>${itemCalories.toFixed(1)} kcal</td>
              <td>${itemProtein.toFixed(1)} g</td>
              <td>${itemCarbs.toFixed(1)} g</td>
              <td>${itemFat.toFixed(1)} g</td>
            </tr>
          `;
        }
      }

      const resultTable = `
        <h3>Nutrition Breakdown</h3>
        <table>
          <tr><th>Item</th><th>Calories</th><th>Protein</th><th>Carbs</th><th>Fat</th></tr>
          ${rows}
          <tr style="font-weight:bold; background:#f4f4f4">
            <td>Total</td>
            <td>${total.calories.toFixed(1)} kcal</td>
            <td>${total.protein.toFixed(1)} g</td>
            <td>${total.carbs.toFixed(1)} g</td>
            <td>${total.fat.toFixed(1)} g</td>
          </tr>
        </table>
      `;

      document.getElementById("results").innerHTML = rows ? resultTable : "<p>No matches found. Try adding items or checking spelling.</p>";
    }

    function openAddModal() {
      document.getElementById("addModal").style.display = "flex";
    }

    function closeAddModal() {
      document.getElementById("addModal").style.display = "none";
      document.getElementById("foodName").value = "";
      document.getElementById("caloriesVal").value = "";
      document.getElementById("proteinVal").value = "";
      document.getElementById("carbsVal").value = "";
      document.getElementById("fatVal").value = "";
    }

    function saveCustomFood() {
      const name = document.getElementById("foodName").value.toLowerCase().trim();
      const calories = parseFloat(document.getElementById("caloriesVal").value);
      const protein = parseFloat(document.getElementById("proteinVal").value);
      const carbs = parseFloat(document.getElementById("carbsVal").value);
      const fat = parseFloat(document.getElementById("fatVal").value);

      if (!name || isNaN(calories) || isNaN(protein) || isNaN(carbs) || isNaN(fat)) {
        alert("Please fill in all fields correctly.");
        return;
      }

      foodDB[name] = { calories, protein, carbs, fat };
      localStorage.setItem("customFoods", JSON.stringify(getCustomFoods()));
      closeAddModal();
      alert(`Saved "${name}" successfully!`);
    }

    function getCustomFoods() {
      const original = ["banana", "boiled egg", "roti", "rice", "100g paneer"];
      const custom = {};
      for (let key in foodDB) {
        if (!original.includes(key)) {
          custom[key] = foodDB[key];
        }
      }
      return custom;
    }
  </script>
</body>
</html>
